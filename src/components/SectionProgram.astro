---
// --- INTERFACE, PROPS, LAYOUTS (sin cambios) ---
interface Props {
  title: string
  description: string
  images: string[]
  orderIndex?: number
}
const { title, description, images, orderIndex = 0 } = Astro.props
const reverse = orderIndex % 2 !== 0
const layouts = [
  "grid-cols-2",
  "grid-cols-2 grid-rows-2 [&>*:first-child]:col-span-1 [&>*:first-child]:row-span-2",
  "grid-cols-2 grid-rows-2 [&>*:first-child]:col-span-2",
  "grid-cols-[2fr_1fr] grid-rows-2 [&>*:nth-child(2)]:row-span-2",
  "grid-cols-2 grid-rows-2 [&>*:nth-child(2)]:col-span-1 [&>*:nth-child(2)]:row-span-2",
  "grid-cols-2 grid-rows-3 [&>*:first-child]:row-span-2",
];
const layout = layouts[orderIndex % layouts.length];
---

<section
  class:list={[
    "flex flex-col md:flex-row w-full items-start justify-between gap-12 px-6 sm:px-10 py-12 md:py-20 md:px-32 border-b-2 border-green-500 bg-white relative", 
    { "md:flex-row-reverse": reverse },
  ]}
>

  <div class="md:w-1/2 flex justify-center md:justify-start 
               w-full md:sticky md:top-20 
               order-1 md:order-none">
    <h2 class="text-3xl sm:text-4xl md:text-5xl font-bold text-green-800 leading-tight 
               text-center md:text-left">
      {title}
    </h2>
  </div>

  <div class="md:w-1/2 flex flex-col justify-start items-center md:items-start gap-8 
               w-full order-2 md:order-none">
    
    <p class="text-green-700 text-base sm:text-lg md:text-xl leading-relaxed max-w-2xl 
               text-center md:text-left">
      {description}
    </p>

    <div class={`grid ${layout} gap-4 w-full aspect-video`}>
      {images.map((img, i) => (
        <div class="overflow-hidden rounded-xl shadow-md h-full w-full">
          
                    <div
            class="w-full h-full cursor-pointer"
            data-lightbox-trigger 
            data-img-src={img} 
            data-alt-text={`${title} imagen ${i + 1}`}
          >
            <img
              src={img}
              alt={`${title} imagen ${i + 1}`}
              class="w-full h-full object-cover transition-transform duration-500 hover:scale-105"
              loading="lazy"
            />
          </div>
                  </div>
      ))}
    </div>
  </div>
</section>

<div 
  id="native-lightbox-modal" 
  class="fixed inset-0 z-[9999] hidden bg-black/80 backdrop-blur-md transition-opacity duration-300"
  aria-modal="true"
  role="dialog"
>
  <div class="relative w-full h-full flex items-center justify-center p-4">
    <button 
      id="close-lightbox" 
      class="absolute top-4 right-4 text-white text-4xl font-light leading-none z-50 p-2 opacity-70 hover:opacity-100 transition-opacity"
      aria-label="Cerrar imagen expandida"
    >
      &times;
    </button>
    <img 
      id="lightbox-image" 
      src="" 
      alt="" 
      class="max-w-full max-h-full object-contain shadow-2xl rounded-lg transition-transform duration-300"
    />
  </div>
</div>
<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    const triggers = document.querySelectorAll('[data-lightbox-trigger]');
    const modal = document.getElementById('native-lightbox-modal');
    const closeButton = document.getElementById('close-lightbox');
    const lightboxImage = document.getElementById('lightbox-image');

    if (!modal) return;

    // Funci贸n para abrir el modal
    const openLightbox = (imgSrc, altText) => {
      lightboxImage.src = imgSrc;
      lightboxImage.alt = altText;
      modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden'; // Evita el scroll del fondo
      // Opcional: Agregar animaci贸n de entrada (ej. escala)
      lightboxImage.style.transform = 'scale(0.8)';
      setTimeout(() => {
        lightboxImage.style.transform = 'scale(1)';
      }, 50);
    };

    // Funci贸n para cerrar el modal
    const closeLightbox = () => {
      modal.classList.add('hidden');
      document.body.style.overflow = ''; // Restaura el scroll
    };

    // 1. Asignar eventos a los triggers (miniaturas)
    triggers.forEach(trigger => {
      trigger.addEventListener('click', () => {
        const imgSrc = trigger.dataset.imgSrc;
        const altText = trigger.dataset.altText;
        openLightbox(imgSrc, altText);
      });
    });

    // 2. Asignar evento al bot贸n de cerrar
    closeButton.addEventListener('click', closeLightbox);

    // 3. Asignar evento al clic fuera de la imagen (en el fondo modal)
    modal.addEventListener('click', (event) => {
      // Verifica si el clic fue directamente en el fondo modal, no en la imagen
        closeLightbox();
    });

    // 4. Asignar evento a la tecla ESC
    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape' && !modal.classList.contains('hidden')) {
        closeLightbox();
      }
    });
  });
</script>