---
interface Props {
  title: string
  description: string
  images: string[]
  orderIndex?: number
}
const { title, description, images, orderIndex = 0 } = Astro.props
const reverse = orderIndex % 2 !== 0

// Layouts del grid (se mantienen igual para respetar tu lógica)
const layouts = [
  "grid-cols-2 grid-rows-3 [&>*:first-child]:row-span-2",  
  "grid-cols-2 grid-rows-2 [&>*:first-child]:col-span-1 [&>*:first-child]:row-span-2",
  "grid-cols-2 grid-rows-2 [&>*:first-child]:col-span-2",
  "grid-cols-[2fr_1fr] grid-rows-2 [&>*:nth-child(2)]:row-span-2",
  "grid-cols-2 grid-rows-2 [&>*:nth-child(2)]:col-span-1 [&>*:nth-child(2)]:row-span-2",
];
const layout = layouts[orderIndex % layouts.length];
---

<section
  class:list={[
    // CAMBIO: Fondo con gradiente sutil en lugar de blanco plano
    // CAMBIO: Quitamos el borde duro inferior y usamos padding más generoso
    "flex flex-col md:flex-row w-full items-start justify-between gap-12 px-6 sm:px-10 py-16 md:py-24 md:px-32 relative overflow-hidden",
    // Alternamos sutilmente el fondo para separar secciones visualmente sin líneas
    orderIndex % 2 === 0 ? "bg-gray-300" : "bg-green-50/40",
    { "md:flex-row-reverse": reverse },
  ]}
>
  <div class:list={[
      "absolute -z-10 w-96 h-96 rounded-full blur-3xl opacity-20 mix-blend-multiply filter pointer-events-none",
      reverse ? "right-0 top-0 bg-green-200" : "left-0 bottom-0 bg-teal-100"
  ]}></div>

  <div class="md:w-1/2 flex flex-col justify-center md:justify-start 
              w-full md:sticky md:top-32 
              order-1 md:order-none z-10">
    
    
    <h2 class="text-3xl sm:text-4xl md:text-5xl font-extrabold text-slate-800 leading-tight 
               text-center md:text-left tracking-tight mb-4">
      {title}
      <span class="text-green-500">.</span>
    </h2>

    <span class="text-9xl font-bold text-green-500 absolute -z-10 -top-32 -left-2 select-none hidden md:block opacity-60">
      0{orderIndex + 1}
    </span>
  </div>

  <div class="md:w-1/2 flex flex-col justify-start items-center md:items-start gap-10 
              w-full order-2 md:order-none z-10">
    
    <p class="text-slate-600 text-lg sm:text-xl leading-relaxed max-w-2xl 
              text-center md:text-left font-medium">
      {description}
    </p>

    <div class={`grid ${layout} gap-4 w-full aspect-video md:aspect-[4/3] lg:aspect-video`}>
      {images.map((img, i) => (
        <div class="overflow-hidden rounded-2xl shadow-lg ring-1 ring-black/5 h-full w-full group relative">
            <div
            class="w-full h-full cursor-pointer overflow-hidden"
            data-lightbox-trigger 
            data-img-src={img} 
            data-alt-text={`${title} imagen ${i + 1}`}
          >
            <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-10 flex items-center justify-center">
                <span class="text-white bg-black/50 rounded-full p-2 backdrop-blur-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h6v6M14 10l6.1-6.1M9 21H3v-6M10 14l-6.1 6.1"/></svg>
                </span>
            </div>

            <img
              src={img}
              alt={`${title} imagen ${i + 1}`}
              class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
              loading="lazy"
            />
          </div>
        </div>
      ))}
    </div>
  </div>
</section><div 
  id="native-lightbox-modal" 
  class="fixed inset-0 z-[9999] hidden bg-black/80 backdrop-blur-md transition-opacity duration-300"
  aria-modal="true"
  role="dialog"
>
  <div class="relative w-full h-full flex items-center justify-center p-4">
    <button 
      id="close-lightbox" 
      class="absolute top-4 right-4 text-white text-4xl font-light leading-none z-50 p-2 opacity-70 hover:opacity-100 transition-opacity"
      aria-label="Cerrar imagen expandida"
    >
      &times;
    </button>
    <img 
      id="lightbox-image" 
      src="" 
      alt="" 
      class="max-w-full max-h-full object-contain shadow-2xl rounded-lg transition-transform duration-300"
    />
  </div>
</div>
<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    const triggers = document.querySelectorAll('[data-lightbox-trigger]');
    const modal = document.getElementById('native-lightbox-modal');
    const closeButton = document.getElementById('close-lightbox');
    const lightboxImage = document.getElementById('lightbox-image');

    if (!modal) return;

    const openLightbox = (imgSrc, altText) => {
      lightboxImage.src = imgSrc;
      lightboxImage.alt = altText;
      modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      lightboxImage.style.transform = 'scale(0.8)';
      setTimeout(() => {
        lightboxImage.style.transform = 'scale(1)';
      }, 50);
    };

    const closeLightbox = () => {
      modal.classList.add('hidden');
      document.body.style.overflow = ''; 
    };

    triggers.forEach(trigger => {
      trigger.addEventListener('click', () => {
        const imgSrc = trigger.dataset.imgSrc;
        const altText = trigger.dataset.altText;
        openLightbox(imgSrc, altText);
      });
    });

    closeButton.addEventListener('click', closeLightbox);

    modal.addEventListener('click', (event) => {
        closeLightbox();
    });

    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape' && !modal.classList.contains('hidden')) {
        closeLightbox();
      }
    });
  });
</script>